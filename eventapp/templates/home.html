{% extends "base.html" %}

{% block title %}Select Experiences{% endblock %}

{% block content %}
  <div class="text-center mt-3">
    <span>&uarr; Swipe for More &darr;</span>
  </div>
  <div class="container my-4">
    <h2 class="text-center mb-4">Upcoming Visits</h2>

    <!-- Using Bootstrap's card-group to ensure all cards are handled uniformly -->
    <div class="card-group">

<!-- Card 1: Private Mini Moo Experience -->
<div class="card border-danger" style="background: linear-gradient(135deg, #fff0f3 0%, #ffeef5 100%);">
  <img src="static/pic/valentinesminimoo.jpg" class="card-img-top" alt="Private Mini Moo Experience at Howe Ranch" style="border-bottom: 3px solid #e91e63;">
  <div class="card-body">
    <h5 class="card-title text-danger" style="font-family: 'serif'; text-shadow: 1px 1px 2px rgba(0,0,0,0.1); color: #e91e63 !important;">üéÅ Private Mini Moo Experience at Howe Ranch</h5>
    
    <div class="text-center p-3 mb-3" style="background: linear-gradient(45deg, #e91e63, #f06292); color: white; border-radius: 10px; box-shadow: 0 4px 8px rgba(0,0,0,0.2);">
      <h4 style="margin: 0; font-weight: bold;">üéÄ GIFT CERTIFICATES AVAILABLE! üéÄ</h4>
    </div>

    <p class="card-text">
      The sweetest gift of the season ‚Äî soft noses, baby cow cuddles & kisses, and bottle-feeding our fluffy Highland calves. Private Mini Moo Experiences are 60-minute, facilitated experiences and are limited during Peak Season (Dec. ‚Äì Feb.).
    </p>

    <p class="card-text">
      During your 60-minute private experience, you'll cuddle our newest tiny fluffy Highland calves, brush and feed the mini herd, and meet alpacas, playful mini goats, donkeys, and new chicks.
      Bottle-feeding of our youngest cow babies is included.
    </p>

    <p class="card-text">
      Explore the farm, enjoy professional photo backdrops with the baby calves, and take home a special souvenir bag.
    </p>

    <ul class="card-text">
      <li>üìç Available by appointment on select dates</li>
      <li>‚è±Ô∏è Duration: 60 minutes</li>
    </ul>

    <div class="text-center p-2 mb-3" style="background: #ffebee; border-radius: 8px; border: 2px dashed #e91e63;">
      <strong>$350 per private group (10 guests max ages 1+)</strong>
    </div>
    
    <p class="card-text">Come ready for fall fun and baby cow kisses!</p>

    <hr>

    <p class="card-text mb-1">By scheduling your visit you agree to:</p>
    <ul class="card-text">
      <li>I have read and agree with the <a href="https://www.thehoweranch.com/_files/ugd/fca21d_a063413021c34f2d814bca731db5d2f4.pdf" target="_blank">Farm Visitor FAQs</a> and <a href="https://www.thehoweranch.com/_files/ugd/fca21d_a30cd343d96b4be3913cded96c226b9f.pdf" target="_blank">Farm Policies</a>.</li>
      <li>This private experience does not allow celebratory or food-related activities (e.g., no cake, decorations, etc.). We offer special gathering options that accommodate celebrations ‚Äî contact us for details.</li>
      <li>This experience is for 1‚Äì10 guests max (ages 1+). Groups over 10 may book a second tour at the same time, join an Open Farm Day, or reserve a private gathering.</li>
      <li>Experiences are transferable to other guests but cannot be refunded and cannot be rescheduled.</li>
    </ul>

    <a href="/select_tickets" class="btn btn-danger w-100" style="background: linear-gradient(45deg, #e91e63, #f06292); border: none; font-weight: bold; text-shadow: 1px 1px 1px rgba(0,0,0,0.3);">üéÅ Register for Private Experience</a>
  </div>
</div>
      <!-- Card 3: Valentine Magic with the Mini Moos -->
      <div class="card border-danger" style="background: linear-gradient(135deg, #fff0f3 0%, #ffeef5 100%);">
        <img src="static/pic/magicvalentine.jpg" class="card-img-top" alt="Valentine Magic with the Mini Moos at Howe Ranch" style="border-bottom: 3px solid #e91e63;">
        <div class="card-body">
          <h5 class="card-title text-danger" style="font-family: 'serif'; text-shadow: 1px 1px 2px rgba(0,0,0,0.1); color: #e91e63 !important;">‚ù§Ô∏è Valentine Magic with the Mini Moos ‚Äî Including Professional Photos</h5>

          <div class="text-center p-3 mb-3" style="background: linear-gradient(45deg, #e91e63, #f06292); color: white; border-radius: 10px; box-shadow: 0 4px 8px rgba(0,0,0,0.2);">
            <h4 style="margin: 0; font-weight: bold;">üéÅ Mary Lou's Special üéÅ</h4>
            <p style="margin: 5px 0 0 0; font-size: 0.9rem;">Select Dates in January & February</p>
          </div>

          <div class="card-text text-center p-2 mb-3" style="background: linear-gradient(45deg, #e91e63, #f06292); color: white; border-radius: 8px; box-shadow: 0 2px 4px rgba(0,0,0,0.2);">
            <strong>üïì Select your date and time slot!</strong>
          </div>

          <p class="card-text">
            Step into Valentine Town at Howe Ranch for a heart-filled, small-group experience created for guests who want something extra special this season. Each group enjoys a two-hour Valentine Magic experience, designed to feel relaxed, unrushed, and full of meaningful moments with the Mini Moos and friends.
          </p>

          <p class="card-text">
            Valentine Magic with the Mini Moos blends baby cow cuddles, whimsical Valentine environments, and a guided professional mini photo session ‚Äî all in a calm, boutique setting before larger visits arrive.
          </p>

          <p class="card-text">
            <strong>This is not a private ranch visit and not an Open Farm Day.</strong> It is a thoughtfully paced, early-access experience shared with a few small couples/families, designed for meaningful moments, beautiful photos, and cozy Valentine magic.
          </p>

          <p class="card-text">
            <strong>‚ú® Your Valentine Magic Experience Includes:</strong>
          </p>
          <ul class="card-text">
            <li>üêÆ Baby Moo kisses & cuddles with our fluffy Highland calves</li>
            <li>üì∏ Two professional mini-session photos with our photographer partner (included with every visit)</li>
            <li>üíò Romantic & whimsical Valentine Town scenes for exploring and memory-making</li>
            <li>üé® Valentine Crafts at our make-and-take station</li>
            <li>üç¨ Seasonal Valentine treats & drinks</li>
            <li>üêê Visits with alpacas, mini highland cows, and mini goats dressed in their Valentine best</li>
            <li>üå∏ A fully staffed, relaxed experience with guided flow ‚Äî no crowds, no chaos</li>
            <li>üíï Much loved and traditional scavenger hunt</li>
          </ul>

          <div class="text-center p-2 mb-3" style="background: #ffebee; border-radius: 8px; border: 2px dashed #e91e63;">
            <strong>üìç Mary Lou's Special: $350 per group</strong><br>
            <strong>üë• Up to 5 guests per visit (ages 1+)</strong><br>
            <strong>üéüÔ∏è Very limited availability ‚Ä¢ Advance online reservation required</strong>
          </div>

          <p class="card-text">
            Valentine Magic with the Mini Moos is perfect for families, couples, and anyone looking to celebrate love with baby cow snuggles, charming Valentine scenes, and professional photos to remember it all.
          </p>

          <div class="border p-3 mb-3" style="background: #f8f9fa; border-radius: 8px;">
            <div class="form-group mb-3">
              <label for="valentine-magic-date" class="form-label"><strong>Select a Date</strong></label>
              <select class="form-control" id="valentine-magic-date" required onchange="updateValentineMagicTimeSlots()">
                <option value="">Choose a Date</option>
                <option value="valentine-magic1">Sunday, January 4</option>
                <option value="valentine-magic2">Saturday, January 17</option>
                <option value="valentine-magic3">Sunday, January 18</option>
                <option value="valentine-magic4">Saturday, January 24</option>
                <option value="valentine-magic5">Saturday, January 31</option>
                <option value="valentine-magic6">Sunday, February 1</option>
                <option value="valentine-magic7">Saturday, February 7</option>
              </select>
            </div>

            <div class="form-group mb-3">
              <label for="valentine-magic-time-slot" class="form-label"><strong>Select Time Slot</strong></label>
              <select class="form-control" id="valentine-magic-time-slot" required disabled>
                <option value="">First select a date</option>
              </select>
            </div>

            <div class="form-group mb-3">
              <label for="valentine-magic-experiences" class="form-label"><strong>Party Size</strong></label>
              <input type="number" class="form-control" id="valentine-magic-experiences" placeholder="Enter number of guests" required min="1" max="5">
            </div>

            <button onclick="goToCheckout('valentine-magic')" class="btn btn-danger w-100" style="background: linear-gradient(45deg, #e91e63, #f06292); border: none; font-weight: bold; text-shadow: 1px 1px 1px rgba(0,0,0,0.3);">‚ù§Ô∏è Register for Valentine Magic Experience ‚ù§Ô∏è</button>
          </div>

          <div class="text-center small" style="color: #6c757d;">
            By scheduling your visit you agree to: I have read and agree with the <a href="https://www.thehoweranch.com/_files/ugd/fca21d_a063413021c34f2d814bca731db5d2f4.pdf" target="_blank">Farm Visitor FAQs</a> and <a href="https://www.thehoweranch.com/_files/ugd/fca21d_a30cd343d96b4be3913cded96c226b9f.pdf" target="_blank">Farm Policies</a>.
          </div>
        </div>
      </div>
      <!-- Card 2: Season of Love Open Farm Day -->
      <div class="card border-danger" style="background: linear-gradient(135deg, #fff0f3 0%, #ffeef5 100%);">
        <img src="static/pic/valentinesopen.jpg" class="card-img-top" alt="Season of Love Open Farm Day at Howe Ranch" style="border-bottom: 3px solid #e91e63;">
        <div class="card-body">
          <h5 class="card-title text-danger" style="font-family: 'serif'; text-shadow: 1px 1px 2px rgba(0,0,0,0.1); color: #e91e63 !important;">‚ù§Ô∏è Season of Love Open Farm Day at Howe Ranch ‚Äî Celebrate the Magic of Togetherness</h5>
          <div class="card-text text-center p-2 mb-3" style="background: linear-gradient(45deg, #e91e63, #f06292); color: white; border-radius: 8px; box-shadow: 0 2px 4px rgba(0,0,0,0.2);">
            <strong>Select Dates in January to February ‚Ä¢ Multiple Time Slots Available</strong><br>
            <strong>üïì Select your date and time slot!</strong>
          </div>

          <p class="card-text">
            This Season of Love, guests are invited to step into a heart-lit magic of Howe Ranch's "Valentine's Town" for a facilitated agritourism farm experience centered on hands-on animal interaction, education, and guided exploration of our working farm. Baby Highland calves in bow headpieces, alpacas in sweetheart scarves, and our friendly goats and donkeys welcome guests into a whimsical, love-themed environment designed as a small-scale farm tour ‚Äî not a crowded fair.
          </p>

          <p class="card-text">
            This experience is intentionally structured to allow guests to move through the farm at a relaxed pace while participating in guided animal encounters, learning about each species, and engaging directly with the Mini Moos and their farm friends under staff supervision.
          </p>

          <p class="card-text">
            <strong>‚ú® Your Season of Love Open Farm Day visit includes:</strong>
          </p>
          <ul class="card-text">
            <li>üêÆ One-on-one time with the baby Mini Moos, with facilitated mini cow cuddling sessions and education on Highland cattle care, behavior, and husbandry</li>
            <li>üö∂‚Äç‚ôÄÔ∏è A curated walking farm tour introducing guests to alpacas, mini goats, donkeys, and other resident animals, with staff-led discussions about their roles on the farm, daily care, and individual personalities</li>
            <li>ü§ó Designated cuddle and interaction stations where guests can safely touch, brush, and connect with animals while learning proper handling and respect for livestock</li>
            <li>üì∏ Several romantic and whimsical farm scenes for photos and memory-making, integrated into the tour route</li>
            <li>üç¨ Seasonal treats and drinks available throughout the experience</li>
            <li>üé® Make-and-take crafts at the Love Letter & Keepsake Station</li>
            <li>üîç The Mini Moos Love Trail scavenger hunt, encouraging exploration of the farm and discovery of animals and learning points along the way</li>
          </ul>

          <p class="card-text">
            There are no lines, no rushing, and no unstructured wandering. Each visit is guided, staffed, and centered on meaningful connection with the animals and the land, with all elements included in one cohesive farm experience.
          </p>

          <div class="text-center p-2 mb-3" style="background: #ffebee; border-radius: 8px; border: 2px dashed #e91e63;">
            <strong>üìç Registration is $35 per guest. Children under 1 attend free.</strong>
          </div>

          <p class="card-text">
            Celebrate love in all its forms ‚Äî family, friendship, and connection ‚Äî while participating in a hands-on agritourism experience rooted in education, animal care, and unforgettable moments with the Mini Moos and their farm companions.
          </p>

          <div class="border p-3 mb-3" style="background: #f8f9fa; border-radius: 8px;">
            <div class="form-group mb-3">
              <label for="valentine-visit-date" class="form-label"><strong>Select a Date</strong></label>
              <select class="form-control" id="valentine-visit-date" required onchange="updateValentineTimeSlots()">
                <option value="">Choose a Date</option>
                <option value="valentine1">Sunday, January 11</option>
                <option value="valentine2">Sunday, January 25</option>
                <option value="valentine3">Sunday, February 8</option>
                <option value="valentine4">Saturday, February 14 (Valentine's Day)</option>
              </select>
            </div>

            <div class="form-group mb-3">
              <label for="valentine-time-slot" class="form-label"><strong>Select Time Slot</strong></label>
              <select class="form-control" id="valentine-time-slot" required disabled>
                <option value="">First select a date</option>
              </select>
            </div>

            <div class="form-group mb-3">
              <label for="valentine-experiences" class="form-label"><strong>Party Size</strong></label>
              <input type="number" class="form-control" id="valentine-experiences" placeholder="Enter number of guests" required min="1" max="10">
            </div>

            <button onclick="goToCheckout('valentine')" class="btn btn-danger w-100" style="background: linear-gradient(45deg, #e91e63, #f06292); border: none; font-weight: bold; text-shadow: 1px 1px 1px rgba(0,0,0,0.3);">üíï Register for Season of Love Adventure üíï</button>
          </div>

          <div class="text-center small" style="color: #6c757d;">
            <strong>üéü Advance Reservation Only ‚Ä¢ No Passes at Gate ‚Ä¢ Limited Capacity</strong>
          </div>

          <div class="text-center small mt-2" style="color: #6c757d;">
            By scheduling your visit you agree to: I have read and agree with the <a href="https://www.thehoweranch.com/_files/ugd/fca21d_a063413021c34f2d814bca731db5d2f4.pdf" target="_blank">Farm Visitor FAQs</a> and <a href="https://www.thehoweranch.com/_files/ugd/fca21d_a30cd343d96b4be3913cded96c226b9f.pdf" target="_blank">Farm Policies</a>.
          </div>
        </div>
      </div>



    <!-- Close card-group -->
  </div> <!-- Close container -->

  <div class="text-center mt-3">
    <span>&uarr; Swipe for More &darr;</span>
  </div>

<script>

function updateValentineTimeSlots() {
    const dateValue = document.getElementById('valentine-visit-date').value;
    const timeSlotSelect = document.getElementById('valentine-time-slot');

    // Clear existing options
    timeSlotSelect.innerHTML = '';

    if (dateValue) {
        // Enable the time slot dropdown
        timeSlotSelect.disabled = false;

        let timeOptions = '<option value="">Choose a Time Slot</option>';
        
        if (dateValue === 'valentine1') {
            // 1/11/26 - Keep 3pm and 4pm as is
            timeOptions += '<option value="3pm">3:00 PM - 6:00 PM</option>';
            timeOptions += '<option value="4pm">4:00 PM - 7:00 PM</option>';
        } else if (dateValue === 'valentine2') {
            // 1/25/26 - 3pm and NEW 12:30pm (remove 4pm)
            timeOptions += '<option value="3pm">3:00 PM - 6:00 PM</option>';
            timeOptions += '<option value="1230pm">12:30 PM - 2:30 PM</option>';
        } else if (dateValue === 'valentine3') {
            // 2/8/26 - 1pm and 3pm (remove 4pm)
            timeOptions += '<option value="1pm">1:00 PM - 3:00 PM</option>';
            timeOptions += '<option value="3pm">3:00 PM - 6:00 PM</option>';
        } else if (dateValue === 'valentine4') {
            // 2/14/26 - Only 12:30pm (remove 4pm)
            timeOptions += '<option value="1230pm">12:30 PM - 2:30 PM</option>';
            timeOptions += '<option value="3pm">3:00 PM - 6:00 PM</option>'
        }
        
        timeSlotSelect.innerHTML = timeOptions;
    } else {
        // Disable the time slot dropdown
        timeSlotSelect.disabled = true;
        timeSlotSelect.innerHTML = '<option value="">First select a date</option>';
    }
}

function updateValentineMagicTimeSlots() {
    const dateValue = document.getElementById('valentine-magic-date').value;
    const timeSlotSelect = document.getElementById('valentine-magic-time-slot');

    // Clear existing options
    timeSlotSelect.innerHTML = '<option value="">Loading available times...</option>';
    timeSlotSelect.disabled = true;

    if (dateValue) {
        // Query available slots for this date
        fetch('/get_events')
            .then(response => response.json())
            .then(events => {
                // Filter events for Valentine Magic and the selected date
                const dateMap = {
                    'valentine-magic1': '2026-01-04',
                    'valentine-magic2': '2026-01-17',
                    'valentine-magic3': '2026-01-18',
                    'valentine-magic4': '2026-01-24',
                    'valentine-magic5': '2026-01-31',
                    'valentine-magic6': '2026-02-01',
                    'valentine-magic7': '2026-02-07'
                };

                const selectedDate = dateMap[dateValue];
                const availableSlots = events.filter(event =>
                    event.title.includes('Valentine Magic with the Mini Moos') &&
                    event.start.startsWith(selectedDate)
                );

                timeSlotSelect.innerHTML = '<option value="">Choose a Time Slot</option>';

                if (availableSlots.length === 0) {
                    timeSlotSelect.innerHTML += '<option value="" style="color: red; font-weight: bold;">üî¥ SOLD OUT - No available slots for this date</option>';
                    timeSlotSelect.disabled = true;
                } else {
                    // Sort by time and add available slots
                    availableSlots.sort((a, b) => new Date(a.start) - new Date(b.start));

                    availableSlots.forEach(event => {
                        const eventDate = new Date(event.start);
                        const endDate = new Date(event.end);
                        const startTime = eventDate.toLocaleTimeString('en-US', {
                            hour: 'numeric',
                            minute: '2-digit',
                            hour12: true
                        });
                        const endTime = endDate.toLocaleTimeString('en-US', {
                            hour: 'numeric',
                            minute: '2-digit',
                            hour12: true
                        });

                        // Create time slot value that matches the mapping
                        const timeSlotValue = startTime.toLowerCase().replace(' ', '');

                        const option = document.createElement('option');
                        option.value = timeSlotValue;
                        option.textContent = `${startTime} - ${endTime}`;
                        option.setAttribute('data-event-id', event.id);
                        timeSlotSelect.appendChild(option);
                    });

                    timeSlotSelect.disabled = false;
                }
            })
            .catch(error => {
                console.error('Error loading available slots:', error);
                timeSlotSelect.innerHTML = '<option value="">Error loading slots</option>';
            });
    } else {
        // Disable the time slot dropdown
        timeSlotSelect.disabled = true;
        timeSlotSelect.innerHTML = '<option value="">First select a date</option>';
    }
}

function goToCheckout(visitType) {
    let visitId, experiences;

    if (visitType === 'spooky') {
        visitId = document.getElementById('spooky-visit-date').value;
        experiences = document.getElementById('spooky-experiences').value;

        if (!visitId || !experiences) {
            alert('Please select a date and enter the number of guests.');
            return;
        }
    } else if (visitType === 'halloween') {
        visitId = '612'; // Halloween Spectacular visit ID
        experiences = document.getElementById('halloween-experiences').value;

        if (!experiences) {
            alert('Please enter the number of guests.');
            return;
        }
    } else if (visitType === 'valentine') {
        const dateValue = document.getElementById('valentine-visit-date').value;
        const timeSlotValue = document.getElementById('valentine-time-slot').value;
        experiences = document.getElementById('valentine-experiences').value;

        if (!dateValue || !timeSlotValue || !experiences) {
            alert('Please select a date, time slot, and enter the number of guests.');
            return;
        }

        // Map combinations of dates and time slots to specific visit IDs
        const visitMapping = {
            // Sunday, January 11
            'valentine1_3pm': '1182', // 3pm-6pm slot
            'valentine1_4pm': '1183', // 4pm-7pm slot
            // Sunday, January 25
            'valentine2_3pm': '1184', // 3pm-6pm slot
            'valentine2_1230pm': '1270', // 12:30pm-2:30pm slot (changed from 4pm-7pm)
            // Sunday, February 8
            'valentine3_1pm': '1271', // 1pm-3pm slot (need event ID)
            'valentine3_3pm': '1186', // 3pm-6pm slot
            // Friday, February 14 (Valentine's Day)
            'valentine4_1230pm': '1272', // 12:30pm-2:30pm slot (need event ID)
            'valentine4_3pm': '1188'  // 3pm-6pm slot
        };
        
        const visitKey = dateValue + '_' + timeSlotValue;
        visitId = visitMapping[visitKey];
        
        if (!visitId) {
            alert('Please select a valid date and time slot.');
            return;
        }
    } else if (visitType === 'valentine-magic') {
        const timeSlotSelect = document.getElementById('valentine-magic-time-slot');
        experiences = document.getElementById('valentine-magic-experiences').value;
        
        if (!timeSlotSelect.value || !experiences) {
            alert('Please select a date, time slot, and enter the number of guests.');
            return;
        }
        
        // Get visit ID from the selected option's data attribute
        const selectedOption = timeSlotSelect.options[timeSlotSelect.selectedIndex];
        visitId = selectedOption.getAttribute('data-event-id');
        
        if (!visitId) {
            alert('Please select a valid time slot.');
            return;
        }
    }
    
    // Redirect to checkout with URL parameters
    window.location.href = `/checkout?event_id=${visitId}&tickets=${experiences}`;
}
</script>

{% endblock %}
