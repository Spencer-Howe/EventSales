{% extends "base.html" %}

{% block title %}Select Experiences{% endblock %}

{% block content %}
  <div class="text-center mt-3">
    <span>&uarr; Swipe for More &darr;</span>
  </div>
  <div class="container my-4">
    <h2 class="text-center mb-4">Upcoming Visits</h2>

    <!-- Using Bootstrap's card-group to ensure all cards are handled uniformly -->
    <div class="card-group">

<!-- Card 1: Private Mini Moo Experience -->
<div class="card border-danger" style="background: linear-gradient(135deg, #fff0f3 0%, #ffeef5 100%);">
  <img src="static/pic/valentinesminimoo.jpg" class="card-img-top" alt="Private Mini Moo Experience at Howe Ranch" style="border-bottom: 3px solid #e91e63;">
  <div class="card-body">
    <h5 class="card-title text-danger" style="font-family: 'serif'; text-shadow: 1px 1px 2px rgba(0,0,0,0.1); color: #e91e63 !important;">üéÅ Private Mini Moo Experience at Howe Ranch</h5>
    
    <div class="text-center p-3 mb-3" style="background: linear-gradient(45deg, #e91e63, #f06292); color: white; border-radius: 10px; box-shadow: 0 4px 8px rgba(0,0,0,0.2);">
      <h4 style="margin: 0; font-weight: bold;">üéÄ GIFT CERTIFICATES AVAILABLE! üéÄ</h4>
    </div>

    <p class="card-text">
      The sweetest gift of the season ‚Äî soft noses, baby cow cuddles & kisses, and bottle-feeding our fluffy Highland calves. Private Mini Moo Experiences are 60-minute, facilitated experiences and are limited during Peak Season (Dec. ‚Äì Feb.).
    </p>

    <p class="card-text">
      During your 60-minute private experience, you'll cuddle our newest tiny fluffy Highland calves, brush and feed the mini herd, and meet alpacas, playful mini goats, donkeys, and new chicks.
      Bottle-feeding of our youngest cow babies is included.
    </p>

    <p class="card-text">
      Explore the farm, enjoy professional photo backdrops with the baby calves, and take home a special souvenir bag.
    </p>

    <ul class="card-text">
      <li>üìç Available by appointment on select dates</li>
      <li>‚è±Ô∏è Duration: 60 minutes</li>
    </ul>

    <div class="text-center p-2 mb-3" style="background: #ffebee; border-radius: 8px; border: 2px dashed #e91e63;">
      <strong>$350 per private group (10 guests max ages 1+)</strong>
    </div>
    
    <p class="card-text">Come ready for fall fun and baby cow kisses!</p>

    <hr>

    <p class="card-text mb-1">By scheduling your visit you agree to:</p>
    <ul class="card-text">
      <li>I have read and agree with the <a href="https://www.thehoweranch.com/_files/ugd/fca21d_a063413021c34f2d814bca731db5d2f4.pdf" target="_blank">Farm Visitor FAQs</a> and <a href="https://www.thehoweranch.com/_files/ugd/fca21d_a30cd343d96b4be3913cded96c226b9f.pdf" target="_blank">Farm Policies</a>.</li>
      <li>This private experience does not allow celebratory or food-related activities (e.g., no cake, decorations, etc.). We offer special gathering options that accommodate celebrations ‚Äî contact us for details.</li>
      <li>This experience is for 1‚Äì10 guests max (ages 1+). Groups over 10 may book a second tour at the same time, join an Open Farm Day, or reserve a private gathering.</li>
      <li>Experiences are transferable to other guests but cannot be refunded and cannot be rescheduled.</li>
    </ul>

    <a href="/select_tickets" class="btn btn-danger w-100" style="background: linear-gradient(45deg, #e91e63, #f06292); border: none; font-weight: bold; text-shadow: 1px 1px 1px rgba(0,0,0,0.3);">üéÅ Register for Private Experience</a>
  </div>
</div>
      <!-- Card 3: Valentine Magic with the Mini Moos -->
      <div class="card border-danger" style="background: linear-gradient(135deg, #fff0f3 0%, #ffeef5 100%);">
        <img src="static/pic/magicvalentine.jpg" class="card-img-top" alt="Valentine Magic with the Mini Moos at Howe Ranch" style="border-bottom: 3px solid #e91e63;">
        <div class="card-body">
          <h5 class="card-title text-danger" style="font-family: 'serif'; text-shadow: 1px 1px 2px rgba(0,0,0,0.1); color: #e91e63 !important;">‚ù§Ô∏è Valentine Magic with the Mini Moos ‚Äî Including Professional Photos</h5>

          <div class="text-center p-3 mb-3" style="background: linear-gradient(45deg, #e91e63, #f06292); color: white; border-radius: 10px; box-shadow: 0 4px 8px rgba(0,0,0,0.2);">
            <h4 style="margin: 0; font-weight: bold;">üéÅ Mary Lou's Special üéÅ</h4>
            <p style="margin: 5px 0 0 0; font-size: 0.9rem;">Select Dates in January & February</p>
          </div>

          <div class="card-text text-center p-2 mb-3" style="background: linear-gradient(45deg, #e91e63, #f06292); color: white; border-radius: 8px; box-shadow: 0 2px 4px rgba(0,0,0,0.2);">
            <strong>üïì Select your date and time slot!</strong>
          </div>

          <p class="card-text">
            Step into Valentine Town at Howe Ranch for a heart-filled, small-group experience created for guests who want something extra special this season. Each group enjoys a two-hour Valentine Magic experience, designed to feel relaxed, unrushed, and full of meaningful moments with the Mini Moos and friends.
          </p>

          <p class="card-text">
            Valentine Magic with the Mini Moos blends baby cow cuddles, whimsical Valentine environments, and a guided professional mini photo session ‚Äî all in a calm, boutique setting before larger visits arrive.
          </p>

          <p class="card-text">
            <strong>This is not a private ranch visit and not an Open Farm Day.</strong> It is a thoughtfully paced, early-access experience shared with a few small couples/families, designed for meaningful moments, beautiful photos, and cozy Valentine magic.
          </p>

          <p class="card-text">
            <strong>‚ú® Your Valentine Magic Experience Includes:</strong>
          </p>
          <ul class="card-text">
            <li>üêÆ Baby Moo kisses & cuddles with our fluffy Highland calves</li>
            <li>üì∏ Two professional mini-session photos with our photographer partner (included with every visit)</li>
            <li>üíò Romantic & whimsical Valentine Town scenes for exploring and memory-making</li>
            <li>üé® Valentine Crafts at our make-and-take station</li>
            <li>üç¨ Seasonal Valentine treats & drinks</li>
            <li>üêê Visits with alpacas, mini highland cows, and mini goats dressed in their Valentine best</li>
            <li>üå∏ A fully staffed, relaxed experience with guided flow ‚Äî no crowds, no chaos</li>
            <li>üíï Much loved and traditional scavenger hunt</li>
          </ul>

          <div class="text-center p-2 mb-3" style="background: #ffebee; border-radius: 8px; border: 2px dashed #e91e63;">
            <strong>üìç Mary Lou's Special: $350 per group</strong><br>
            <strong>üë• Up to 5 guests per visit (ages 1+)</strong><br>
            <strong>üéüÔ∏è Very limited availability ‚Ä¢ Advance online reservation required</strong>
          </div>

          <p class="card-text">
            Valentine Magic with the Mini Moos is perfect for families, couples, and anyone looking to celebrate love with baby cow snuggles, charming Valentine scenes, and professional photos to remember it all.
          </p>

          <div class="border p-3 mb-3" style="background: #f8f9fa; border-radius: 8px;">
            <div class="form-group mb-3">
              <label for="valentine-magic-date" class="form-label"><strong>Select a Date</strong></label>
              <select class="form-control" id="valentine-magic-date" required onchange="updateValentineMagicTimeSlots()">
                <option value="">Choose a Date</option>
                <option value="valentine-magic1">Sunday, January 4</option>
                <option value="valentine-magic2">Saturday, January 17</option>
                <option value="valentine-magic3">Sunday, January 18</option>
                <option value="valentine-magic4">Saturday, January 24</option>
                <option value="valentine-magic5">Saturday, January 31</option>
                <option value="valentine-magic6">Sunday, February 1</option>
                <option value="valentine-magic7">Saturday, February 7</option>
              </select>
            </div>

            <div class="form-group mb-3">
              <label for="valentine-magic-time-slot" class="form-label"><strong>Select Time Slot</strong></label>
              <select class="form-control" id="valentine-magic-time-slot" required disabled>
                <option value="">First select a date</option>
              </select>
            </div>

            <div class="form-group mb-3">
              <label for="valentine-magic-experiences" class="form-label"><strong>Party Size</strong></label>
              <input type="number" class="form-control" id="valentine-magic-experiences" placeholder="Enter number of guests" required min="1" max="5">
            </div>

            <button onclick="goToCheckout('valentine-magic')" class="btn btn-danger w-100" style="background: linear-gradient(45deg, #e91e63, #f06292); border: none; font-weight: bold; text-shadow: 1px 1px 1px rgba(0,0,0,0.3);">‚ù§Ô∏è Register for Valentine Magic Experience ‚ù§Ô∏è</button>
          </div>

          <div class="text-center small" style="color: #6c757d;">
            By scheduling your visit you agree to: I have read and agree with the <a href="https://www.thehoweranch.com/_files/ugd/fca21d_a063413021c34f2d814bca731db5d2f4.pdf" target="_blank">Farm Visitor FAQs</a> and <a href="https://www.thehoweranch.com/_files/ugd/fca21d_a30cd343d96b4be3913cded96c226b9f.pdf" target="_blank">Farm Policies</a>.
          </div>
        </div>
      </div>
      <!-- Card 2: Season of Love Open Farm Day -->
      <div class="card border-danger" style="background: linear-gradient(135deg, #fff0f3 0%, #ffeef5 100%);">
        <img src="static/pic/valentinesopen.jpg" class="card-img-top" alt="Season of Love Open Farm Day at Howe Ranch" style="border-bottom: 3px solid #e91e63;">
        <div class="card-body">
          <h5 class="card-title text-danger" style="font-family: 'serif'; text-shadow: 1px 1px 2px rgba(0,0,0,0.1); color: #e91e63 !important;">‚ù§Ô∏è Season of Love Open Farm Day at Howe Ranch ‚Äî Celebrate the Magic of Togetherness</h5>
          <div class="card-text text-center p-2 mb-3" style="background: linear-gradient(45deg, #e91e63, #f06292); color: white; border-radius: 8px; box-shadow: 0 2px 4px rgba(0,0,0,0.2);">
            <strong>Select Dates in January to February ‚Ä¢ 3pm‚Äì6pm & 4pm‚Äì7pm</strong><br>
            <strong>üïì Select your date and time slot!</strong>
          </div>
          
          <p class="card-text">
            This Season of Love, step into a heart-lit Valentine's Town where baby Highland calves in flower crowns, alpacas in sweetheart scarves, and our adorable goats and donkeys welcome you into a world of pure whimsy. Designed as a micro love-themed festival ‚Äî not a crowded fair ‚Äî this enchanted experience lets you wander, cuddle, craft, and explore at your own pace, with every station included.
          </p>
          
          <p class="card-text">
            <strong>‚ú® Your Season of Love Pass Includes:</strong>
          </p>
          <ul class="card-text">
            <li>üêÆ Guided "Love Walks" with our baby Mini Moos through Valentine's Town</li>
            <li>üíå Several romantic + whimsical scenes for photos and memory-making (think: Serenity Garden, Cupid's Courtyard, Sweetheart Sanctuary,...)</li>
            <li>üç¨ Seasonal treats and drinks for all ages</li>
            <li>üé® Make-and-take crafts at our Love Letter & Keepsake Station</li>
            <li>üíï Mini Moos Love Trail scavenger hunt with prizes</li>
            <li>üêê Visits with alpacas and mini goats dressed in their Valentine best</li>
            <li>üåü No lines. No rushing. Just real connection, cozy moments, and magical time with the animals ‚Äî all included.</li>
          </ul>
          
          <div class="text-center p-2 mb-3" style="background: #ffebee; border-radius: 8px; border: 2px dashed #e91e63;">
            <strong>üìç Registration: $35 per guest, kids under 1 are free</strong>
          </div>
          
          <p class="card-text">
            Celebrate love in all its forms ‚Äî family, friendship, romance ‚Äî as the baby Moos take you through an unforgettable Season of Love experience at the farm.
          </p>
          
          <div class="border p-3 mb-3" style="background: #f8f9fa; border-radius: 8px;">
            <div class="form-group mb-3">
              <label for="valentine-visit-date" class="form-label"><strong>Select a Date</strong></label>
              <select class="form-control" id="valentine-visit-date" required onchange="updateValentineTimeSlots()">
                <option value="">Choose a Date</option>
                <option value="valentine1">Sunday, January 11</option>
                <option value="valentine2">Sunday, January 25</option>
                <option value="valentine3">Sunday, February 8</option>
                <option value="valentine4">Saturday, February 14 (Valentine's Day)</option>
              </select>
            </div>
            
            <div class="form-group mb-3">
              <label for="valentine-time-slot" class="form-label"><strong>Select Time Slot</strong></label>
              <select class="form-control" id="valentine-time-slot" required disabled>
                <option value="">First select a date</option>
              </select>
            </div>
            
            <div class="form-group mb-3">
              <label for="valentine-experiences" class="form-label"><strong>Party Size</strong></label>
              <input type="number" class="form-control" id="valentine-experiences" placeholder="Enter number of guests" required min="1" max="10">
            </div>
            
            <button onclick="goToCheckout('valentine')" class="btn btn-danger w-100" style="background: linear-gradient(45deg, #e91e63, #f06292); border: none; font-weight: bold; text-shadow: 1px 1px 1px rgba(0,0,0,0.3);">üíï Register for Season of Love Adventure üíï</button>
          </div>
          
          <div class="text-center small" style="color: #6c757d;">
            <strong>üéü Advance Reservation Only ‚Ä¢ No Passes at Gate ‚Ä¢ Limited Capacity</strong>
          </div>
          
          <div class="text-center small mt-2" style="color: #6c757d;">
            By scheduling your visit you agree to: I have read and agree with the <a href="https://www.thehoweranch.com/_files/ugd/fca21d_a063413021c34f2d814bca731db5d2f4.pdf" target="_blank">Farm Visitor FAQs</a> and <a href="https://www.thehoweranch.com/_files/ugd/fca21d_a30cd343d96b4be3913cded96c226b9f.pdf" target="_blank">Farm Policies</a>.
          </div>
        </div>
      </div>



    <!-- Close card-group -->
  </div> <!-- Close container -->

  <div class="text-center mt-3">
    <span>&uarr; Swipe for More &darr;</span>
  </div>

<script>

function updateValentineTimeSlots() {
    const dateValue = document.getElementById('valentine-visit-date').value;
    const timeSlotSelect = document.getElementById('valentine-time-slot');
    
    // Clear existing options
    timeSlotSelect.innerHTML = '';
    
    if (dateValue) {
        // Enable the time slot dropdown
        timeSlotSelect.disabled = false;
        
        // Add time slot options
        timeSlotSelect.innerHTML = `
            <option value="">Choose a Time Slot</option>
            <option value="3pm">3:00 PM - 6:00 PM</option>
            <option value="4pm">4:00 PM - 7:00 PM</option>
        `;
    } else {
        // Disable the time slot dropdown
        timeSlotSelect.disabled = true;
        timeSlotSelect.innerHTML = '<option value="">First select a date</option>';
    }
}

function updateValentineMagicTimeSlots() {
    const dateValue = document.getElementById('valentine-magic-date').value;
    const timeSlotSelect = document.getElementById('valentine-magic-time-slot');
    
    // Clear existing options
    timeSlotSelect.innerHTML = '<option value="">Loading available times...</option>';
    timeSlotSelect.disabled = true;
    
    if (dateValue) {
        // Query available slots for this date
        fetch('/get_events')
            .then(response => response.json())
            .then(events => {
                // Filter events for Valentine Magic and the selected date
                const dateMap = {
                    'valentine-magic1': '2026-01-04',
                    'valentine-magic2': '2026-01-17', 
                    'valentine-magic3': '2026-01-18',
                    'valentine-magic4': '2026-01-24',
                    'valentine-magic5': '2026-01-31',
                    'valentine-magic6': '2026-02-01',
                    'valentine-magic7': '2026-02-07'
                };
                
                const selectedDate = dateMap[dateValue];
                const availableSlots = events.filter(event => 
                    event.title.includes('Valentine Magic with the Mini Moos') &&
                    event.start.startsWith(selectedDate)
                );
                
                timeSlotSelect.innerHTML = '<option value="">Choose a Time Slot</option>';
                
                if (availableSlots.length === 0) {
                    timeSlotSelect.innerHTML += '<option value="" style="color: red; font-weight: bold;">üî¥ SOLD OUT - No available slots for this date</option>';
                    timeSlotSelect.disabled = true;
                } else {
                    // Sort by time and add available slots
                    availableSlots.sort((a, b) => new Date(a.start) - new Date(b.start));
                    
                    availableSlots.forEach(event => {
                        const eventDate = new Date(event.start);
                        const endDate = new Date(event.end);
                        const startTime = eventDate.toLocaleTimeString('en-US', {
                            hour: 'numeric',
                            minute: '2-digit',
                            hour12: true
                        });
                        const endTime = endDate.toLocaleTimeString('en-US', {
                            hour: 'numeric',
                            minute: '2-digit', 
                            hour12: true
                        });
                        
                        // Create time slot value that matches the mapping
                        const timeSlotValue = startTime.toLowerCase().replace(' ', '');
                        
                        const option = document.createElement('option');
                        option.value = timeSlotValue;
                        option.textContent = `${startTime} - ${endTime}`;
                        option.setAttribute('data-event-id', event.id);
                        timeSlotSelect.appendChild(option);
                    });
                    
                    timeSlotSelect.disabled = false;
                }
            })
            .catch(error => {
                console.error('Error loading available slots:', error);
                timeSlotSelect.innerHTML = '<option value="">Error loading slots</option>';
            });
    } else {
        // Disable the time slot dropdown
        timeSlotSelect.disabled = true;
        timeSlotSelect.innerHTML = '<option value="">First select a date</option>';
    }
}

function goToCheckout(visitType) {
    let visitId, experiences;
    
    if (visitType === 'spooky') {
        visitId = document.getElementById('spooky-visit-date').value;
        experiences = document.getElementById('spooky-experiences').value;
        
        if (!visitId || !experiences) {
            alert('Please select a date and enter the number of guests.');
            return;
        }
    } else if (visitType === 'halloween') {
        visitId = '612'; // Halloween Spectacular visit ID
        experiences = document.getElementById('halloween-experiences').value;
        
        if (!experiences) {
            alert('Please enter the number of guests.');
            return;
        }
    } else if (visitType === 'valentine') {
        const dateValue = document.getElementById('valentine-visit-date').value;
        const timeSlotValue = document.getElementById('valentine-time-slot').value;
        experiences = document.getElementById('valentine-experiences').value;
        
        if (!dateValue || !timeSlotValue || !experiences) {
            alert('Please select a date, time slot, and enter the number of guests.');
            return;
        }
        
        // Map combinations of dates and time slots to specific visit IDs
        const visitMapping = {
            // Sunday, January 11
            'valentine1_3pm': '1182', // 3pm-6pm slot
            'valentine1_4pm': '1183', // 4pm-7pm slot
            // Sunday, January 25  
            'valentine2_3pm': '1184', // 3pm-6pm slot
            'valentine2_4pm': '1185', // 4pm-7pm slot
            // Sunday, February 8
            'valentine3_3pm': '1186', // 3pm-6pm slot
            'valentine3_4pm': '1187', // 4pm-7pm slot
            // Friday, February 14 (Valentine's Day)
            'valentine4_3pm': '1188', // 3pm-6pm slot
            'valentine4_4pm': '1189'  // 4pm-7pm slot
        };
        
        const visitKey = dateValue + '_' + timeSlotValue;
        visitId = visitMapping[visitKey];
        
        if (!visitId) {
            alert('Please select a valid date and time slot.');
            return;
        }
    } else if (visitType === 'valentine-magic') {
        const timeSlotSelect = document.getElementById('valentine-magic-time-slot');
        experiences = document.getElementById('valentine-magic-experiences').value;
        
        if (!timeSlotSelect.value || !experiences) {
            alert('Please select a date, time slot, and enter the number of guests.');
            return;
        }
        
        // Get visit ID from the selected option's data attribute
        const selectedOption = timeSlotSelect.options[timeSlotSelect.selectedIndex];
        visitId = selectedOption.getAttribute('data-event-id');
        
        if (!visitId) {
            alert('Please select a valid time slot.');
            return;
        }
    }
    
    // Redirect to checkout with URL parameters
    window.location.href = `/checkout?event_id=${visitId}&tickets=${experiences}`;
}
</script>

{% endblock %}
