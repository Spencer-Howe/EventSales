<!-- templates/select_tickets.html -->
{% extends "base.html" %}

{% block title %}Select Tickets{% endblock %}

{% block content %}
<body>
<h1>Payment Receipt</h1>
<p><strong>Name:</strong> {{name}}</p>
<p><strong>Email:</strong> {{email}}</p>
<p>Order ID: {{ order_id }}</p>
<p>Total Amount: {{ amount }}</p>
<p>Currency: {{ currency }}</p>
<p>Status: {{ status }}</p>
<p>Time slot: {{time_slot}}</p>
<p>Number of Tickets: {{ tickets }}</p>
<div class="mb-3">
    <a href="{{ url_for('views.sign_waiver', order_id=order_id) }}" class="btn btn-primary">Please Complete Registration</a>
</div>

<!-- QR Code for Check-in -->
<div class="text-center mb-4" style="border: 2px dashed #007bff; padding: 20px; border-radius: 10px; background-color: #f8f9fa;">
    <h3 style="color: #007bff; margin-bottom: 15px;">ðŸ“± Quick Check-In</h3>
    <p><strong>Show this QR code when you arrive for instant check-in!</strong></p>
    {% if qr_code %}
        <img src="{{ qr_code }}" alt="Check-in QR Code" style="width: 200px; height: 200px; margin: 10px;">
    {% endif %}
    
    <!-- Mobile-friendly download options -->
    <div style="margin: 15px 0;">
        <a href="{{ url_for('views.download_qr_code', order_id=order_id) }}" 
           class="btn btn-success btn-sm" 
           style="margin: 5px; padding: 10px 20px; background-color: #28a745; border: none; color: white; text-decoration: none; border-radius: 5px; display: inline-block;"
           download>
            ðŸ“¥ Download QR Code
        </a>
        <button onclick="shareQRCode()" 
                class="btn btn-info btn-sm" 
                style="margin: 5px; padding: 10px 20px; background-color: #17a2b8; border: none; color: white; border-radius: 5px;"
                id="shareBtn">
            ðŸ“¤ Share QR Code
        </button>
    </div>
    
    <p style="margin-top: 10px; font-size: 0.9rem; color: #6c757d;">
        Or visit: <code>{{ checkin_url }}</code>
    </p>
</div>

<script>
async function shareQRCode() {
    const shareBtn = document.getElementById('shareBtn');
    
    // Check if Web Share API is supported
    if (navigator.share) {
        try {
            // Fetch the QR code image as blob
            const response = await fetch('{{ url_for("views.download_qr_code", order_id=order_id) }}');
            const blob = await response.blob();
            const file = new File([blob], 'qr_code_{{ order_id }}.png', { type: 'image/png' });
            
            await navigator.share({
                title: 'Check-in QR Code - Howe Ranch',
                text: 'My check-in QR code for Howe Ranch visit',
                files: [file]
            });
        } catch (error) {
            // Fallback to download if sharing fails
            fallbackDownload();
        }
    } else {
        // Fallback for browsers that don't support Web Share API
        fallbackDownload();
    }
}

function fallbackDownload() {
    // Create a temporary link and trigger download
    const link = document.createElement('a');
    link.href = '{{ url_for("views.download_qr_code", order_id=order_id) }}';
    link.download = 'qr_code_{{ order_id }}.png';
    document.body.appendChild(link);
    link.click();
    document.body.removeChild(link);
}
</script>

<hr>

<h2>Thank You for Your Purchase!</h2>
<hr>
<p><strong>Contributions (passes/hay)</strong> are free for guests under 1 year old, not transferable, not refundable, and cannot be rescheduled. As our focus is on animal care, we do not have the capacity to accommodate changes â€” please do not call to request exceptions.</p>
<p>Looking forward to having you with us!</p>
<p>Thank you for purchasing passes to the Mini Moos experience at Howe Ranch! Youâ€™re on our guest listâ€”just identify yourself at the welcome table when you arrive.</p>
<p>Weâ€™ll see you at:</p>
<p><strong>22053 Highland St, Wildomar, CA 92595</strong></p>
<p>Looking forward to having you with us!</p>
<p>Best regards,</p>
<p>Spencer Howe</p>


</body>

    {% endblock %}
