{% extends 'admin/master.html' %}

{% block body %}
<div class="container-fluid">
    <h2>Search Bookings</h2>
    
    <div class="row">
        <div class="col-md-12">
            <div class="panel panel-default">
                <div class="panel-heading">
                    <h3 class="panel-title">Search Criteria</h3>
                </div>
                <div class="panel-body">
                    <form method="POST" action="{{ url_for('search_bookings.index') }}">
                        <div class="row">
                            <div class="col-md-4">
                                <div class="form-group">
                                    <label for="search_type">Search By:</label>
                                    <select class="form-control" id="search_type" name="search_type">
                                        <option value="name" {% if search_type == 'name' %}selected{% endif %}>Customer Name</option>
                                        <option value="email" {% if search_type == 'email' %}selected{% endif %}>Email Address</option>
                                        <option value="order_id" {% if search_type == 'order_id' %}selected{% endif %}>Order ID</option>
                                        <option value="phone" {% if search_type == 'phone' %}selected{% endif %}>Phone Number</option>
                                    </select>
                                </div>
                            </div>
                            <div class="col-md-6">
                                <div class="form-group">
                                    <label for="search_term">Search Term:</label>
                                    <input type="text" class="form-control" id="search_term" name="search_term" 
                                           value="{{ search_term }}" placeholder="Enter search term...">
                                </div>
                            </div>
                            <div class="col-md-2">
                                <div class="form-group">
                                    <label>&nbsp;</label><br>
                                    <button type="submit" class="btn btn-primary">Search</button>
                                </div>
                            </div>
                        </div>
                    </form>
                </div>
            </div>
        </div>
    </div>

    {% if search_results %}
    <div class="row">
        <div class="col-md-12">
            <div class="panel panel-default">
                <div class="panel-heading">
                    <h3 class="panel-title">Search Results ({{ search_results|length }} found)</h3>
                </div>
                <div class="panel-body">
                    <div class="table-responsive">
                        <table class="table table-striped table-bordered">
                            <thead>
                                <tr>
                                    <th>Order ID</th>
                                    <th>Customer Name</th>
                                    <th>Email</th>
                                    <th>Phone</th>
                                    <th>Event Time</th>
                                    <th>Tickets</th>
                                    <th>Amount</th>
                                    <th>Payment Method</th>
                                    <th>Status</th>
                                </tr>
                            </thead>
                            <tbody>
                                {% for booking in search_results %}
                                <tr>
                                    <td>{{ booking.order_id }}</td>
                                    <td>{{ booking.customer.name if booking.customer else 'No customer' }}</td>
                                    <td>{{ booking.customer.email if booking.customer else 'No email' }}</td>
                                    <td>{{ booking.customer.phone if booking.customer else 'No phone' }}</td>
                                    <td>{{ booking.event.start.strftime('%Y-%m-%d %H:%M') if booking.event and booking.event.start else 'N/A' }}</td>
                                    <td>{{ booking.tickets }}</td>
                                    <td>${{ "%.2f"|format(booking.payments[0].amount_paid) if booking.payments else 'No payment' }}</td>
                                    <td>{{ booking.payments[0].payment_method|title if booking.payments else 'No payment method' }}</td>
                                    <td>
                                        <span class="label {% if booking.payments and booking.payments[0].status == 'confirmed' %}label-success{% elif booking.payments and booking.payments[0].status == 'pending_crypto' %}label-warning{% else %}label-default{% endif %}">
                                            {{ booking.payments[0].status|title if booking.payments else 'No status' }}
                                        </span>
                                    </td>
                                </tr>
                                {% endfor %}
                            </tbody>
                        </table>
                    </div>
                </div>
            </div>
        </div>
    </div>
    {% elif search_term %}
    <div class="row">
        <div class="col-md-12">
            <div class="alert alert-info">
                <strong>No results found</strong> for "{{ search_term }}" in {{ search_type|replace('_', ' ')|title }}.
            </div>
        </div>
    </div>
    {% endif %}
</div>
{% endblock %}